<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Личный кабинет — Автомастерская</title>
  <meta name="description" content="Личный кабинет клиента автосервиса: история записей, статус ремонта, данные автомобиля, профиль." />

  <!-- Те же шрифты и стили, что на главной -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/style.css"> <!-- подключи свои стили -->
  <style>
    :root {
      --primary: #e11d48;
      --muted: #64748b;
      --bg: #f8fafc;
    }
    .profile-avatar {
      width: 100px; height: 100px; border-radius: 50%; background: #e2e8f0; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #64748b;
    }
    .status {
      padding: 4px 12px; border-radius: 999px; font-size: 0.875rem; font-weight: 600;
    }
    .status--waiting { background: #fef3c7; color: #92400e; }
    .status--in-progress { background: #dbeafe; color: #1e40af; }
    .status--ready { background: #d1fae5; color: #065f46; }
    .status--completed { background: #f3f4f6; color: #374151; }
  </style>
</head>

<body>
  <a class="skip" href="#main">К основному содержимому</a>

  <!-- Шапка такая же, как на главной, только активна иконка кабинета -->
  <header>
    <div class="container topbar" role="banner">
      <div class="brand">
        <span class="brand__logo" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="34" height="40" fill="#e11d48">
            <path d="M22.5,14H1.5a7.109,7.109,0,0,1,.423-.88L3.98,9.52A5.013,5.013,0,0,1,8.321,7h7.358A5.011,5.011,0,0,1,20.02,9.52l2.057,3.6A7.116,7.116,0,0,1,22.5,14ZM19,16v1a1,1,0,0,1-2,0V16H7v1a1,1,0,0,1-2,0V16H1.026Q1,16.3,1,16.594V18a4,4,0,0,0,2,3.463V22a2,2,0,0,0,4,0H17a2,2,0,0,0,4,0v-.537A4,4,0,0,0,23,18V16.594q0-.3-.026-.594ZM23,4H22a1,1,0,0,1,0-2h1c.673,0,.625-.448.493-.649A3.015,3.015,0,0,0,18.167,2H5.845A3.015,3.015,0,0,0,.519,1.351C0,2.283,1.926,1.939,2.012,2a1,1,0,0,1,0,2h-1c-.673,0-.625.448-.493.649A3.015,3.015,0,0,0,5.845,4H18.167a3.015,3.015,0,0,0,5.326.649C23.625,4.448,23.673,4,23,4Z"/>
          </svg>
        </span>
        <span class="brand__name">Автомастерская</span>
      </div>

      <nav aria-label="Основная навигация">
        <ul>
          <li><a class="nav__link" href="auto.html#services">Услуги</a></li>
          <li><a class="nav__link" href="auto.html#pricing">Цены</a></li>
          <li><a class="nav__link" href="auto.html#booking">Бронирование</a></li>
          <li><a class="nav__link" href="auto.html#reviews">Отзывы</a></li>
          <li><a class="nav__link" href="auto.html#contacts">Контакты</a></li>
        </ul>
      </nav>

      <div class="actions" role="group" aria-label="Действия">
        <a href="tel:+375290000000" class="actions__icon" aria-label="Позвонить">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1v3.49c0 .55-.45 1-1 1C9.25 21 3 14.75 3 7.5c0-.55.45-1 1-1H7.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
        </a>
        <a href="auto.html#booking" class="actions__icon" aria-label="Записаться">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        </a>
        <!-- Иконка кабинета теперь активна (можно убрать ссылку или оставить) -->
        <a href="cabinet.html" class="actions__icon" aria-label="Личный кабинет" aria-current="page">
          <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </a>
      </div>
    </div>
  </header>

  <main id="main" tabindex="-1" style="padding-top: 3rem; padding-bottom: 4rem; background: var(--bg); min-height: 80vh;">
    <div class="container">

      <!-- Приветствие и аватар -->
      <section class="grid grid--2" style="align-items: center; margin-bottom: 3rem; gap: 2rem;">
        <div class="profile-avatar">ИП</div>
        <div>
          <h1 style="margin:0; font-size: 2rem;">Добро пожаловать, Иван Петров!</h1>
          <p style="color: var(--muted); margin: 0.5rem 0 0;">+375 (29) 123-45-67 • ivan@example.com</p>
        </div>
      </section>

      <!-- Блок статистики -->
      <div class="grid grid--4" style="margin-bottom: 3rem; gap: 1rem;">
        <div class="card" style="text-align:center; padding:1.5rem;">
          <strong style="font-size:2rem; color:var(--primary);">3</strong><br>
          <span style="color:var(--muted);">Активные записи</span>
        </div>
        <div class="card" style="text-align:center; padding:1.5rem;">
          <strong style="font-size:2rem; color:#16a34a;">12</strong><br>
          <span style="color:var(--muted);">Завершённых визитов</span>
        </div>
        <div class="card" style="text-align:center; padding:1.5rem;">
          <strong style="font-size:2rem; color:#2563eb;">2</strong><br>
          <span style="color:var(--muted);">Авто в профиле</span>
        </div>
        <div class="card" style="text-align:center; padding:1.5rem;">
          <strong style="font-size:2rem; color:#f59e0b;">★ 4.9</strong><br>
          <span style="color:var(--muted);">Ваш рейтинг</span>
        </div>
      </div>

      <!-- Текущие записи -->
      <section style="margin-bottom: 4rem;">
        <h2 style="margin-bottom: 1.5rem;">Текущие и предстоящие записи</h2>

        <div class="grid grid--1" style="gap: 1rem;">

          <!-- Запись 1 -->
          <article class="card" style="padding:1.5rem; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;">
            <div>
              <strong>Skoda Octavia A7 • A123BC 79</strong><br>
              <time datetime="2025-12-15T14:00">15 декабря 2025, 14:00</time> • Замена масла и фильтров
            </div>
            <div style="text-align:right;">
              <span class="status status--in-progress">В работе</span><br>
              <small style="color:var(--muted);">Осталось ~40 минут</small>
            </div>
          </article>

          <!-- Запись 2 -->
          <article class="card" style="padding:1.5rem; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;">
            <div>
              <strong>Volkswagen Polo • X777XX 77</strong><br>
              <time datetime="2025-12-18T10:30">18 декабря 2025, 10:30</time> • Шиномонтаж (зима)
            </div>
            <div style="text-align:right;">
              <span class="status status--waiting">Ожидает</span>
            </div>
          </article>

          <!-- Запись 3 (готово) -->
          <article class="card" style="padding:1.5rem; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;">
            <div>
              <strong>Skoda Octavia A7 • A123BC 79</strong><br>
              <time datetime="2025-12-10T11:00">10 декабря 2025, 11:00</time> • Диагностика подвески
            </div>
            <div style="text-align:right;">
              <span class="status status--ready">Готово к выдаче</span><br>
              <a href="#" class="btn btn--primary" style="margin-top:0.5rem; font-size:0.9rem;">Оплатить онлайн (4 200 ₽)</a>
            </div>
          </article>

        </div>

        <p style="text-align:center; margin-top:2rem;">
          <a href="auto.html#booking" class="btn btn--primary">Записаться на новую услугу</a>
        </p>
      </section>

      <!-- История посещений (свёрнутая) -->
      <section>
        <h2 style="margin-bottom: 1rem;">История посещений</h2>
        <details style="background:#fff; border-radius:8px; padding:1rem;">
          <summary style="cursor:pointer; font-weight:600; margin-bottom:0.5rem;">Показать все 12 записей</summary>
          <table style="width:100%; border-collapse:collapse; margin-top:1rem;">
            <thead>
              <tr style="text-align:left; color:var(--muted);">
                <th style="padding:0.5rem 0;">Дата</th>
                <th>Авто</th>
                <th>Услуга</th>
                <th>Сумма</th>
                <th>Статус</th>
              </tr>
            </thead>
            <tbody style="font-size:0.95rem;">
              <tr>
                <td style="padding:0.5rem 0;">05.11.2025</td>
                <td>Skoda Octavia</td>
                <td>ТО-60 000 км</td>
                <td>18 500 ₽</td>
                <td><span class="status status--completed">Выполнено</span></td>
              </tr>
              <tr>
                <td style="padding:0.5rem 0;">12.09.2025</td>
                <td>VW Polo</td>
                <td>Шиномонтаж</td>
                <td>4 800 ₽</td>
                <td><span class="status status--completed">Выполнено</span></td>
              </tr>
              <!-- можно добавить ещё строк -->
            </tbody>
          </table>
        </details>
      </section>

      <!-- Мои автомобили -->
      <section style="margin-top: 4rem;">
        <h2 style="margin-bottom: 1rem;">Мои автомобили</h2>
        <div class="grid grid--3" style="gap:1rem;">
          <div class="card" style="padding:1.5rem; text-align:center;">
            <strong>Skoda Octavia A7</strong><br>
            <small>A123BC 79 • 2019 г. • 1.8 TSI</small><br>
            <small style="color:var(--muted);">Пробег: 87 400 км</small>
          </div>
          <div class="card" style="padding:1.5rem; text-align:center;">
            <strong>Volkswagen Polo</strong><br>
            <small>X777XX 77 • 2021 г. • 1.6 MPI</small><br>
            <small style="color:var(--muted);">Пробег: 34 200 км</small>
          </div>
          <div class="card" style="padding:1.5rem; text-align:center; display:flex; align-items:center; justify-content:center; flex-direction:column;">
            <span style="font-size:3rem; color:#cbd5e1;">+</span>
            <a href="#" style="margin-top:0.5rem;">Добавить автомобиль</a>
          </div>
        </div>
      </section>

      <!-- Кнопка выхода -->
      <div style="margin-top: 4rem; text-align:center;">
        <a href="#" style="color:var(--muted); text-decoration:underline;">Выйти из личного кабинета</a>
      </div>

    </div>
  </main>

<script>
fetch("/api/check-auth")
  .then(res => res.json())
  .then(data => {
    if (!data.authorized) {
      window.location.href = "/auth.html";
    }
  });


  // Загрузка данных пользователя
  const userName = localStorage.getItem("userName") || "Клиент";
  const userPhone = localStorage.getItem("userPhone") || "Не указан";
  const userEmail = localStorage.getItem("userEmail") || "Не указан";

  document.getElementById("user-name").textContent = userName;
  document.getElementById("display-name").textContent = userName;
  document.getElementById("display-phone").textContent = userPhone;
  document.getElementById("display-email").textContent = userEmail;

  // Пример записей (в реальности — с бэкенда)
  const bookings = JSON.parse(localStorage.getItem("userBookings") || "[]");
  const list = document.getElementById("bookings-list");

  if (bookings.length === 0) {
    list.innerHTML = `<p style="color: var(--muted);">У вас пока нет записей</p>`;
  } else {
    list.innerHTML = bookings.map(b => `
      <div class="booking-item">
        <strong>${b.service}</strong><br>
        ${b.car} · ${b.date} в ${b.time} · 
        <span class="${b.status === 'done' ? 'status-done' : 'status-confirmed'}">
          ${b.status === 'done' ? 'Выполнено' : 'Подтверждено'}
        </span>
      </div>
    </div>
  </footer>

  <button id="to-top" class="to-top" aria-label="Наверх">↑</button>
  <script src="/scripts/app.js" defer></script>
</body>
</html>